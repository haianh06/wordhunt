<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel - Word Hunt</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&display=swap" rel="stylesheet">
  <style>
    body { font-family:'Poppins',sans-serif; background:#f3f4f6; margin:0; padding:20px; }
    h1 { text-align:center; margin-bottom:20px; }
    .container{ max-width:1000px; margin:auto; }
    .card{ background:#fff; padding:16px; margin-bottom:20px; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,.1); }
    .card h2{ margin-top:0; font-size:1.2rem; }
    input,textarea,select{ width:100%; padding:8px; margin:6px 0; border:1px solid #ccc; border-radius:6px; }
    button{ background:#4b2c82; color:#fff; padding:6px 12px; border:none; border-radius:6px; cursor:pointer; font-weight:bold; }
    button:hover{ background:#2196f3 }
    table{ width:100%; border-collapse:collapse; margin-top:12px }
    th,td{ border:1px solid #ddd; padding:6px; text-align:center }
    th{ background:#f9fafb }
    .flex{ display:flex; gap:12px; flex-wrap:wrap; }
    .half{ flex:1; min-width:280px; }
    .btn-delete{ background:#e63946; }
    .btn-delete:hover{ background:#c1121f; }
  </style>
</head>
<body>
  <h1>ğŸ›  Admin Panel - Word Hunt</h1>
  <div class="container">

    <!-- Quáº£n lÃ½ Tá»ª cáº§n tÃ¬m -->
    <div class="card">
      <h2>ğŸ“‹ Quáº£n lÃ½ danh sÃ¡ch tá»«</h2>
      <div class="flex">
        <div class="half">
          <label>ID / Sá»‘ thá»© tá»±</label>
          <input type="number" id="wId" placeholder="VD: 1">
        </div>
        <div class="half">
          <label>Tá»« (IN HOA, khÃ´ng dáº¥u cÃ¡ch)</label>
          <input type="text" id="wText" placeholder="VD: INNOVATION">
        </div>
      </div>
      <button onclick="addWord()">â• ThÃªm/ Cáº­p nháº­t tá»«</button>
      <table>
        <thead><tr><th>ID</th><th>Tá»«</th><th>HÃ nh Ä‘á»™ng</th></tr></thead>
        <tbody id="wordTable"></tbody>
      </table>
    </div>

    <!-- Quáº£n lÃ½ ngÆ°á»i chÆ¡i -->
    <div class="card">
      <h2>ğŸ† NgÆ°á»i chÆ¡i</h2>
      <button onclick="exportExcel()">â¬‡ Xuáº¥t Excel</button>
      <table>
        <thead><tr><th>TÃªn</th><th>Email</th><th>Sá»‘ tá»« Ä‘Ãºng</th><th>Thá»i gian (s)</th></tr></thead>
        <tbody id="playerTable"></tbody>
      </table>
    </div>

  </div>

<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbw9O7Wsr59P5g3WJ_XuJmiCRIc0NqLdV5tdogH4rddfJW4ZEmjbbPKmIoUHCnfaVa8bFA/exec";

  // ğŸ“Œ Load danh sÃ¡ch tá»«
  async function loadWords(){
    try{
      let res = await fetch(API_URL+"?mode=words");
      let data = await res.json();
      const body = document.getElementById("wordTable");
      body.innerHTML="";
      data.forEach(w=>{
        const id = (typeof w === 'string') ? '' : (w.id ?? w.number ?? '');
        const word = (typeof w === 'string') ? w : (w.word || w.answer || '');
        const tr=document.createElement("tr");
        tr.innerHTML=`
          <td>${id}</td>
          <td>${word}</td>
          <td>
            <button class="btn-delete" onclick="deleteWord(${id||0}, '${word}')">ğŸ—‘ XÃ³a</button>
          </td>`;
        body.appendChild(tr);
      });
    }catch(e){
      alert("KhÃ´ng táº£i Ä‘Æ°á»£c danh sÃ¡ch tá»«. Kiá»ƒm tra API.");
    }
  }

  // ğŸ“Œ ThÃªm/ cáº­p nháº­t tá»«
  function addWord(){
    const id=document.getElementById("wId").value;
    const word=document.getElementById("wText").value.trim().toUpperCase();
    if(!word){alert("Nháº­p tá»«!");return;}
    fetch(API_URL,{
      method:"POST",
      body:JSON.stringify({
        mode:"addWord",
        id:id,
        word:word
      })
    }).then(r=>r.text()).then(t=>{
      alert("âœ… LÆ°u thÃ nh cÃ´ng!");
      loadWords();
    });
  }

  // ğŸ“Œ XÃ³a tá»« (Æ°u tiÃªn theo id, náº¿u khÃ´ng cÃ³ id sáº½ xoÃ¡ theo word)
  function deleteWord(id, word){
    if(!confirm("Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a '"+word+"'?")) return;
    fetch(API_URL,{
      method:"POST",
      body:JSON.stringify({
        mode:"deleteWord",
        id:id,
        word:word
      })
    }).then(r=>r.text()).then(t=>{
      alert("ğŸ—‘ ÄÃ£ xÃ³a!");
      loadWords();
    });
  }

  // ğŸ“Œ Load ngÆ°á»i chÆ¡i
  async function loadPlayers(){
    let res=await fetch(API_URL);
    let players=await res.json();
    const body=document.getElementById("playerTable");
    body.innerHTML="";
    players
      .sort((a,b)=>b.correct-a.correct || a.duration-b.duration)
      .forEach(p=>{
        const tr=document.createElement("tr");
        tr.innerHTML=`<td>${escapeHtml(p.name)}</td><td>${escapeHtml(p.email)}</td><td>${p.correct}</td><td>${p.duration}</td>`;
        body.appendChild(tr);
      });
  }

  // ğŸ“Œ Xuáº¥t Excel ngÆ°á»i chÆ¡i
  function exportExcel(){
    fetch(API_URL)
      .then(r=>r.json())
      .then(players=>{
        const ws=XLSX.utils.json_to_sheet(players);
        const wb=XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb,ws,"Players");
        XLSX.writeFile(wb,"wordhunt_players.xlsx");
      });
  }

  function escapeHtml(text){
    return String(text).replace(/[&<>"'`=\\/]/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;','/':'&#47;'}[s]));
  }

  // auto refresh
  loadWords();
  loadPlayers();
  setInterval(loadPlayers,5000);
</script>
</body>
</html>